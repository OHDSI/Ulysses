<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting credentials • Ulysses</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Setting credentials">
<meta property="og:description" content="Ulysses">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">Ulysses</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/archive/atlas.html">Connecting Ulysses to ATLAS</a>
    </li>
    <li>
      <a href="../../articles/archive/credentials.html">Setting credentials</a>
    </li>
    <li>
      <a href="../../articles/get_started.html">Get Started with Ulysses</a>
    </li>
    <li>
      <a href="../../articles/archive/start_study.html">Creating a study using Ulysses</a>
    </li>
    <li>
      <a href="../../articles/ulysses_structure.html">The Ulysses Standard Repository Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link">hadesLogo</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting credentials</h1>
            
      
      
      <div class="hidden name"><code>credentials.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we show you how to set up credentials to use within
a <code>Ulysses</code> directory and load them automatically into a
<code>config.yml</code> file; a file used to quickly and securely access
your credentials throughout the development of a study. The
<code>config.yml</code> file is automatically ignored within the project
directory, ensuring that it is never loaded into the git repository.
Important credentials include:</p>
<ul>
<li>Connection Information
<ul>
<li>dbms: the database management system. Currently accept snowflake,
postgres, redshift, sql server and oracle.</li>
<li>user: the user name for your connection</li>
<li>password: the password for your connection</li>
<li>connectionString: a jdbc connection to interface with the database
hosting the OMOP CDM</li>
</ul>
</li>
<li>Database Schemas
<ul>
<li>cdmDatabaseSchema: the location of the OMOP CDM</li>
<li>workDatabasSchema: a read/write schema to save the cohort table and
other analysis tables</li>
<li>tempEmulationSchema: a temp schema used in snowflake and oracle to
process temp tables</li>
</ul>
</li>
</ul>
<p>Each site has their own OMOP database and credentials; they should be
stored securely. Likely you have the same credentials for every study,
so only you want to load them once across all your studies; updating
them only when required by your IT setup at your institution. In this
vignette we first explain how to set-up a credentials store that Ulysses
can automatically access. Second we explain how Ulysses will build the
<code>config.yml</code> file throughout the study.</p>
<p>This vignette shows you how to set up the <code>config.yml</code>
file automatically.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Ulysses</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>There are two ways you can set up your credentials. Option 1 is to
build a csv file of your credential information per database. When
building the <code>config.yml</code> file it will ingest all preset
credentials, orient them for the study. Option 2 is to use the keyring
api to store all your credentials. A templated <code>config.yml</code>
will wrap each credential with a call to keyring to grab the
credentials.</p>
<div class="section level3">
<h3 id="option-1-using-credentials-table-shhh-csv">Option 1: Using credentials table (<code>shhh.csv</code>)<a class="anchor" aria-label="anchor" href="#option-1-using-credentials-table-shhh-csv"></a>
</h3>
<p>Our first option in setting up credentials is to setup a credentials
table as a csv file. This reference file is accessed when creating a
<code>config.yml</code> for a project. To begin building the credentials
table we use the codeblock below (shown as an example):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">initCredentialsTable</span><span class="op">(</span></span>
<span>  db_id <span class="op">=</span> <span class="st">"omop_dat"</span>,</span>
<span>  db_full_name <span class="op">=</span> <span class="st">"My OMOP Database"</span>,</span>
<span>  dbms <span class="op">=</span> <span class="st">"redshift"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"mike_jones"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"who?"</span>,</span>
<span>  connection_string <span class="op">=</span> <span class="st">"jdbc:redshift://281.330.8004?remaining_string"</span>,</span>
<span>  cdm_database_schema <span class="op">=</span> <span class="st">"cdm"</span>,</span>
<span>  work_database_schema <span class="op">=</span> <span class="st">"scratch"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This table of credentials will be saved as a file called
<code>shhh.csv</code> to your home directory, by default. To check what
your home directory is run: <code><a href="https://fs.r-lib.org/reference/path_expand.html" class="external-link">fs::path_home()</a></code>. To check your
stored credentials you can run the command
<code>openCredentials()</code>. Future releases will allow you to edit
the credential table in the R studio viewer.</p>
</div>
<div class="section level3">
<h3 id="option-2-using-keyring">Option 2: Using Keyring<a class="anchor" aria-label="anchor" href="#option-2-using-keyring"></a>
</h3>
<p>The second option is to store credentials for each database
connection in the keyring API. Ulysses provides a helper function to
assist with this setup.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">initCredentialsKeyring</span><span class="op">(</span></span>
<span>  db_id <span class="op">=</span> <span class="st">"omop_dat"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When running this block of code, a dialog box will appear asking you
to input required credentials. Type them into the dialog box one by one.
At the end the function will return blurred output of your credentials
to review.</p>
</div>
</div>
<div class="section level2">
<h2 id="initializing-the-config-yml">Initializing the <code>config.yml</code><a class="anchor" aria-label="anchor" href="#initializing-the-config-yml"></a>
</h2>
<p>Once you have setup your database credentials outside the Ulysses
project, you can now utilize them at the start of a new study.</p>
<div class="section level3">
<h3 id="on-build">On build<a class="anchor" aria-label="anchor" href="#on-build"></a>
</h3>
<p>This is a future option. When using the <code>newOhdsiStudy</code>
you can state that you want to initialize the <code>config.yml</code>
during the project build. This however is not yet available.</p>
</div>
<div class="section level3">
<h3 id="after-build">After build<a class="anchor" aria-label="anchor" href="#after-build"></a>
</h3>
<p>After you have run <code>newOhdsiStudy</code> and navigated into the
new project, you should initialize the <code>config.yml</code> file.
This is done using the code-block below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">initConfigUsingTable</span><span class="op">(</span><span class="op">)</span> <span class="co"># initialize the config using the shhh.csv file</span></span>
<span></span>
<span><span class="fu">initConfigUsingKeyring</span><span class="op">(</span><span class="op">)</span> <span class="co"># initialize the config using keyring</span></span></code></pre></div>
<p>A new <code>config.yml</code> file will open after running these
functions. If initializing from the table, the credentials are read in
“as-is”. If initializing from keyring, the keyring R package is wrapped
on every line of the config prefixed by <code>!expr</code>. This
notifies R to evaluate the item in the file. To check that the keyring
works, you can run the <code><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">keyring::key_get</a></code> command in the
config line in the console. If it evaluates then it will work on the
config call, if not an error will occur when evaluating.</p>
</div>
</div>
<div class="section level2">
<h2 id="config-yml-in-action">
<code>config.yml</code> in action<a class="anchor" aria-label="anchor" href="#config-yml-in-action"></a>
</h2>
<p>The config file allows you to quickly and securely shuffle between
connection to the OMOP CDM for a study. Ulysses uses the config package
to pull the correct configuration from this file to connect to the
database.</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set connection Block</span></span>
<span><span class="co"># &lt;&lt;&lt;</span></span>
<span><span class="va">configBlock</span> <span class="op">&lt;-</span> <span class="st">"[Add config block]"</span></span>
<span><span class="co"># &gt;&gt;&gt;</span></span>
<span></span>
<span><span class="co"># provide connection details</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="fu">config</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/config/reference/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"dbms"</span>, config <span class="op">=</span> <span class="va">configBlock</span><span class="op">)</span>,</span>
<span>  user <span class="op">=</span> <span class="fu">config</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/config/reference/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"user"</span>, config <span class="op">=</span> <span class="va">configBlock</span><span class="op">)</span>,</span>
<span>  password <span class="op">=</span> <span class="fu">config</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/config/reference/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"password"</span>, config <span class="op">=</span> <span class="va">configBlock</span><span class="op">)</span>,</span>
<span>  connectionString <span class="op">=</span> <span class="fu">config</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/config/reference/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"connectionString"</span>, config <span class="op">=</span> <span class="va">configBlock</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>By setting the configBlock to a block header in the
<code>config.yml</code> file, we can pull the connectionDetails of the
correct database. Say we had a configBlock in the yml called
<code>omop_data</code>. If I set <code>omop_data</code> in the script,
it will evaluate the connection to correct configuration using the
<code>config</code> package. While not required to script in this
fashion, Ulysses leverages this pattern often in its templated
files.</p>
</div>
<div class="section level2">
<h2 id="comments">Comments<a class="anchor" aria-label="anchor" href="#comments"></a>
</h2>
<div class="section level3">
<h3 id="editing-the-config-yml-file">Editing the <code>config.yml</code> file<a class="anchor" aria-label="anchor" href="#editing-the-config-yml-file"></a>
</h3>
<p>It is possible to edit the <code>config.yml</code> file by either
changing an existing item or adding a new block. Be sure to save and
restart the R session after making any changes.</p>
</div>
<div class="section level3">
<h3 id="common-issues">Common Issues<a class="anchor" aria-label="anchor" href="#common-issues"></a>
</h3>
<p>Keyring can be difficult to debug. A known issue when working in a
Linux environment is the need to install libsodium and libsecret. Be
sure to run these commands in the terminal prior to insalling
keyring.</p>
<pre><code>sudo yum install libsodium libsodium-devel
sudo yum install libsecret libsecret-devel
sudo chmod 777 /home/idies/.config </code></pre>
<p>If the <code>config</code> package begins to return weird errors, it
is likely that it is not able to evaluate the commands wrapped in
keyring. To debug, either check the <code><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">keyring::key_get</a></code> call
in the console or hard code the credential into the
<code>config.yml</code> file.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Lavallee.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
